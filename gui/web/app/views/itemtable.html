<table class="table item-table">
  <tbody>
  <tr ng-if="items.length === 0"><td colspan="99">There are no items to show.</td></tr>

  <tr ng-repeat-start="item in items track by item.id" scroll-if="row.edit === true" ng-click="item.attributes.isa !== 'StateVariable' && itemListSvc.expandChildren(row, true)" item-drag="{isa: 'Hierarchy', id: item.id}" ng-attr-draggable="{{(item.isa === 'Operation') ? 'true' : 'false'}}" class="accordion-toggle" ng-class-odd="'odd-row'" ng-class-even="'even-row'" ng-init="row={dropdownOpen: false, loadChildren: false, edit: false, expandChildren: false, infoIsCollapsed: true, children: [] }; addItemExpandListener(item, row);">
    <td class="checkbox-column"><input type="checkbox" ng-disabled="item.attributes.isa === 'StateVariable'" ng-click="itemListSvc.stopPropagation($event)" ng-model="item.checked" ng-change="alterCheckedArray(item)" /></td>
    <td ng-repeat="column in selection">{{item[column]}}</td>
    <td ng-repeat="attrColumn in attrSelection">{{item['attributes'][attrColumn]}}</td>
    <td class="item-table-buttons">
      <button class="btn btn-xs btn-default" ng-click="itemListSvc.stopPropagation($event); row.expandChildren = false; row.infoIsCollapsed = !row.infoIsCollapsed;" ng-if="!row.edit"><span class="glyphicon glyphicon-info-sign"></span></button>
      <button class="btn btn-xs btn-default" ng-click="row.expandChildren = false; row.infoIsCollapsed = false; row.edit=true; itemListSvc.stopPropagation($event);" ng-if="!row.edit" ><span class="glyphicon glyphicon-edit"></span></button>
      <button class="btn btn-xs btn-default" ng-click="itemForm.$valid && itemListSvc.saveItem(item, row); itemListSvc.stopPropagation($event);" ng-if="row.edit" type="submit"><span class="glyphicon glyphicon-floppy-disk"></span></button>
      <button class="btn btn-xs btn-default" ng-click="itemListSvc.reReadFromServer(item, row); itemListSvc.stopPropagation($event);" ng-if="row.edit" ><span class="glyphicon glyphicon-remove"></span></button>
      <button class="btn btn-xs btn-default" ng-click="itemListSvc.deleteItem(item); itemListSvc.stopPropagation($event);" ng-if="!row.edit"><span class="glyphicon glyphicon-remove"></span></button>
      <button class="btn btn-xs btn-default" create-dropdown><span class="glyphicon glyphicon-plus"></span></button>
    </td>
  </tr>

  <tr ng-class-odd="'odd-row'" ng-class-even="'even-row'">
    <td colspan="99" class="hiddenRow">
      <form class="form-inline" name="itemForm">
        <div collapse="row.infoIsCollapsed">
          <table class="table">
            <tbody>

              <tr ng-if="row.edit">
                <td class="col-md-1">name:</td>
                <td class="col-md-9" ng-if="row.edit">
                  <ng-form name="textForm">
                    <input no-whitespace name="textInput" type="text" ng-maxlength="40" class="form-control input-sm" ng-model="item.name" auto-focus />
                    <span class="error" ng-show="textForm.textInput.$error.nowhitespace"><br />Whitespace is not allowed here.</span>
                  </ng-form>
                </td>
              </tr>

              <tr ng-repeat="(key, prop) in item | filterElements">
                <td class="col-md-1" >{{key}}:</td>
                <td class="col-md-9">
                  <attr-grid attr-obj="item" key="key" edit="row.edit" add-window="addWindow"></attr-grid>
                </td>
              </tr>

              <tr ng-repeat="(key, prop) in item.attributes | filterElements">
                <td class="col-md-1">
                  <deleteable-key attr-obj="item.attributes" element="key" key="key" edit="row.edit"></deleteable-key>
                </td>
                <td class="col-md-9">
                  <attr-grid key="key" attr-obj="item.attributes" edit="row.edit" add-window="addWindow"></attr-grid>
                </td>
              </tr>

              <tr>
                <td class="col-md-1">type:</td>
                <td class="col-md-9">{{item.isa}}</td>
              </tr>
              <tr>
                <td class="col-md-1">id:</td>
                <td class="col-md-9">{{item.id}}</td>
              </tr>

              <tr ng-if="row.edit">
                <td></td>
                <td>
                  <div class="btn-group" dropdown>
                    <button type="button" class="btn btn-sm btn-default dropdown-toggle">
                      <span class="glyphicon glyphicon-plus"></span> Add attribute <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                      <li ng-repeat="(key, value) in spTalker.activeModel.attributes.attributeTags" ng-click="itemListSvc.addAttribute(item.attributes, key, value)"><a href="#">{{key}}</a></li>
                    </ul>
                  </div>
                </td>
              </tr>

            </tbody>
          </table>
        </div> <!-- end of accordion-body -->
      </form>
    </td>
  </tr>

  <tr ng-repeat-end ng-class-odd="'odd-row'" ng-class-even="'even-row'">
    <td colspan="99" class="hiddenRow">
      <form class="form-inline" name="itemForm">
        <div style="margin-left: 5%;" ng-if="row.loadChildren" collapse="!(row.expandChildren && row.loadChildren)">
          <item-table parent-item="item" alter-checked-array="alterCheckedArray" selection="selection" attr-selection="attrSelection" add-window="addWindow" item-list-scope="itemListScope"></item-table>
        </div> <!-- end of accordion-body -->
      </form>
    </td>
  </tr>

  </tbody>
</table>