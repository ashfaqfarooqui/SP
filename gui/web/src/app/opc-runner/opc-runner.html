<div ng-controller="opcRunnerController as vm">
    <div class="panel-content">
        <div ng-if="vm.state == null" style="padding: 10px;">
            <b>To start, select the items (operations and variables) that constitute your model. Then click "get initial state"</b>
            <textarea class="form-control" ng-model="vm.selected" ng-list/>
            <button class="btn btn-default" ng-click="vm.reload_selection()">
                <i class="fa fa-download"></i>
                get selected items
            </button>
            <button class="btn btn-default" ng-click="vm.attributes = []">
                <i class="fa fa-times"></i>
                clear
            </button>
            <button type="button" class="btn btn-sm btn-primary" ng-click="vm.get_init_state()">
                <i class="fa fa-play"></i> Get initial state
            </button>
        </div>
        <div ng-if="vm.state != null">
            <div style="padding: 10px; float: left; width: 50%">
                <h4>Enabled operations</h4>
                <label>Filter operations: <input ng-model="vm.manualOpsFilterQuery"></label>
                <table ng-repeat="op in vm.manualEnabled | orderBy:'name' | filter:vm.manualOpsFilterQuery">
                    <tr>
                        <td style="padding: 5px">
                            <button type="button" class="btn btn-sm btn-primary" ng-click="vm.execute_op(vm.state,op.id)">
                                <i class="fa fa-play"></i>{{op.name}}
                            </button>
                        </td>
                    </tr>
                </table>
            </div>

            <div style="padding: 10px; float: right; width: 50%">
                <h4>System state</h4>
                <label>Filter operations: <input ng-model="vm.opsFilterQuery"></label>
                <table>
                    <thead>
                        <th class="col-md-5">Operation</th>
                        <th class="col-md-5">State</th>
                        <th class="col-md-2">Autorun</th>
                    </thead>
                    <tbody ng-repeat="op in vm.operations | orderBy:'name' |  filter:vm.opsFilterQuery">
                        <tr>
                            <td class="col-md-5">{{op.name}}</td>
                            <td class="col-md-5">{{op.state}}</td>
                            <td class="col-md-2"><center><input type="checkbox" ng-model="op.item.attributes.autostart"/></center></td>
                        </tr>
                    </tbody>
                </table>
                <br>
                <label>Filter variables: <input ng-model="vm.varsFilterQuery"></label>
                <table>
                    <thead>
                        <th class="col-md-4">Variable</th>
                        <th class="col-md-4">State</th>
                        <th class="col-md-4"></th>
                    </thead>
                    <tbody ng-repeat="op in vm.variables | orderBy:'name' |  filter:vm.varsFilterQuery">
                        <tr>
                            <td class="col-md-4">{{op.name}}</td>
                            <td class="col-md-4">{{op.state}}</td>
                            <td class="col-md-4"></td>
                        </tr>
                    </tbody>
                </table>
                <table ng-repeat="dev in vm.devices | orderBy:'item.name'">
                    <thead>
                        <th class="col-md-6">Device</th>
                        <th class="col-md-4">Pose</th>
                        <th class="col-md-2">Pose name</th>
                    </thead>
                    <tr>
                        <td class="col-md-6">{{dev.item.name}}</td>
                        <td class="col-md-4"><small>{{dev.current_pose}}</small></td>
                        <td class="col-md-2"><b>{{dev.current_pose_name}}</b></td>
                    </tr>
                </table>
            </div>
        </div>

    </div>
</div>
